#!/usr/bin/env bash

# Return the exit status of "git log" (assuming "perl -pe s/foo/bar/" always
# has an exit status of 0).
set -o pipefail;

git log --pretty=format:'%C(yellow)%h%C(reset) %C(blue)(%ar)%C(reset) %s %C(blue)(%an)%C(reset) %C(bold yellow)%d%C(reset)' -n 20 "$@" | perl -p -e '
	# Change "3 weeks ago" into "3 weeks".
	s/^([^)]*) ago\)/\1)/;
	# Abbreviate the time units.
	s/^([^)]*) (s)econd(s?)\)/\1\2)/;
	s/^([^)]*) (m)inute(s?)\)/\1\2)/;
	s/^([^)]*) (h)our(s?)\)/\1\2)/;
	s/^([^)]*) (d)ay(s?)\)/\1\2)/;
	s/^([^)]*) (w)eek(s?)\)/\1\2)/;
	s/^([^)]*) (mon)th(s?)\)/\1 \2)/;
	s/^([^)]*) (y)ear[^)]*\)/\1\2)/;
	# Use at least two digits before the time unit for nicer alignment
	# (until there are commits older than nine years). Of course, because of
	# "mon" for "months", alignment is off for old-ish commits.
	s/\(([0-9])([^0-9 ])/ (\1\2/;
' | sh -c $(git var GIT_PAGER);
