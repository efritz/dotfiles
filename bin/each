#!/usr/bin/env python3

import os
import subprocess
import sys


def main():
    dirname, command = parse_args()
    dirname = os.path.realpath(dirname)

    if not command:
        print('no command supplied')
        sys.exit(1)

    for filename in os.listdir(dirname):
        path = os.path.join(dirname, filename)
        if not os.path.isdir(path) or filename.startswith('.'):
            continue

        subprocess.Popen(
            command,
            cwd=path,
            stdout=sys.stdout,
            stderr=sys.stderr,
        ).communicate()


def parse_args():
    if len(sys.argv) > 1 and sys.argv[1] == '--dir':
        return sys.argv[2], sys.argv[3:]

    return '.', sys.argv[1:]


if __name__ == '__main__':
    main()
